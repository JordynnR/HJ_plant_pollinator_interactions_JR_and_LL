---
title: "Data_cleaning"
output: html_document
date: "2025-11-19"
---

Questions for Rebecca:
1. network- do we need to choose/keep one of the columns in the spreadsheet of the interaction strength values? sankey plot maybe- investigate required inputs
2. would spatial data even be useful to us
3. native vs. non-native plants- how to deal with mixed??


columns to keep:
GenusSpecies
PlantGenusSpecies
Date

```{r}
##read data in
raw_data<- read.csv("raw_data/spec_net_copy.csv")

```

##get rid of columns
```{r}
library(tidyverse)
library(dplyr)
##only keeping date, pollinator species and plant species columns
kept_columns<- raw_data %>%
  select(Date, GenusSpecies, PlantGenusSpecies) %>%
  rename(PollinatorGenusSpecies= GenusSpecies) %>% #rename GenusSpecies to PollinatorGenusSpecies to more easily differentiate
  dplyr::filter(PollinatorGenusSpecies!="") %>%
  dplyr::filter(PlantGenusSpecies!="")           #get rid of empty rows

```

transform date to month number

```{r}
class(kept_columns) #test class= data frame

#replacing the values in the Date column with only the first number of each, which is the month
kept_columns$Date <- sub("^(\\d{1,2})/.*", "\\1", kept_columns$Date)

#rename Date to Month
kept_columns <- kept_columns%>%
  rename(Month = Date)

##test to make sure months are now just months, should be single numbers and not a full date
table(kept_columns$Month)

#change month values from characters to numerics
kept_columns$Month<- as.numeric(kept_columns$Month)

#test that months are numeric
class(kept_columns$Month)
```

use regex to filter out spp/sp (unknown) species
```{r}
#test to see what pollinator species name are present
unique(kept_columns$PollinatorGenusSpecies)
#found a lot of unknown species that we can't use because we can't determine whether they are native or not for our analysis, so we will use regular expressions to filter them out

##create regex to use for filtering
#looks for pattern ending in any variation of spp/sp with any number of "."; got from the class demo
sp_ending_regex <- "(^\\s*[A-Za-z]+\\s+)[sS][pP]{1,2}\\.?\\s*$"
#looks for pattern ending in "sp."+"any numeric" with optional space or . in between; asked copilot
sp_number_regex <- "sp\\.?\\s?[0-9]+$"
#looks for pattern that is only genus; got from class demo
genus_only_regex <-   "^\\s*([A-Za-z]+)\\s*$"

#filter rows that are not (!) in the reg expressions above (had to make 2 for 2 different formats)
no_unknown<- kept_columns %>%
  dplyr::filter(!(PollinatorGenusSpecies = grepl(sp_ending_regex,PollinatorGenusSpecies))) %>%
  dplyr::filter(!(PollinatorGenusSpecies = grepl(sp_number_regex,PollinatorGenusSpecies))) %>%
  dplyr::filter(!(PollinatorGenusSpecies = grepl(genus_only_regex,PollinatorGenusSpecies)))

```

fix plant species with no space
```{r}
#test to see what plant species name are present
unique(no_unknown$PlantGenusSpecies)
#didn't find any unknown plant species, but 1 plant species is listed with no space as Liliumcolumbianum

#replace the incorrect species format with the right format using a regex and the exact correct wording
no_unknown$PlantGenusSpecies<- gsub("^Liliumcolumbianum$", "Lilium columbianum", no_unknown$PlantGenusSpecies)

#check to see that it's been replaced
unique(no_unknown$PlantGenusSpecies)

```

make column for native plants- 1 for native (TRUE), 0 for non-native (FALSE)
```{r}
##Use unique to pull out unique species in PlantGenusSpecies
plant_species<- unique(no_unknown$PlantGenusSpecies)
##copied and pasted this vector and asked copilot to reference Oregon Flora and Calflora to see which plant species listed in the vector are native and which are non-native
##according to Oregon Flora and Calflora, two species has both a native version and introduced version from Eurasia: Achillea millefolium and Prunella vulgaris- decided to include them as natives because the species still counts as native
##there were also four species that are non-native: Rumex acetosella, Hypericum perforatum, Taraxacum officinale, Vicia sativa

#vector representing native species without the non-native species or those that could go either way
native_plants<- c(
  "Delphinium menziesii","Vicia americana","Viola orbiculata","Lathyrus nevadensis",
  "Potentilla gracilis","Polygonum phytolaccifolium","Ligusticum grayi","Orthocarpus imbricatus",
  "Aquilegia formosa","Cirsium callilepis","Eriogonum compositum","Symphoricarpos mollis",
  "Erigeron foliosus","Senecio triangularis","Lupinus laxiflorus","Fragaria virginiana",
  "Rudbeckia occidentalis","Aster ledophyllus","Solidago canadensis","Penstemon procerus",
  "Potentilla glandulosa","Mimulus nanus","Mimulus guttatus","Montia parvifolia",
  "Mimulus tilingii","Phacelia hastata","Calochortus subalpinus","Eriophyllum lanatum",
  "Amelanchier alnifolia","Penstemon cardwellii","Arenaria macrophylla","Sedum oreganum",
  "Silene douglasii","Arctostaphylos nevadensis","Sorbus sitchensis","Rosa gymnocarpa",
  "Castilleja hispida","Zigadenus venenosus","Phlox gracilis","Collinsia parviflora",
  "Epilobium anagallidifolium","Angelica arguta","Gilia capitata","Eriogonum umbellatum",
  "Acmispon nevadensis","Agoseris heterophylla","Eriogonum nudum","Lomatium martindalei",
  "Erysimum asperum","Arenaria capillaris","Ranunculus uncinatus","Clarkia amoena",
  "Lomatium triternatum","Rainiera stricta","Stachys cooleyae","Holodiscus dumosus",
  "Polemonium carneum","Dichelostemma congestum","Gayophytum humile","Stellaria crispa",
  "Rubus parviflorus","Heracleum lanatum","Tiarella trifoliata","Smilacina racemosa",
  "Anaphalis margaritacea","Chamerion angustifolium","Dodecatheon jeffreyi","Mertensia bella",
  "Boykinia major","Perideridia gairdneri","Microseris nutans","Campanula scouleri",
  "Castilleja miniata","Apocynum androsaemifolium","Senecio integerrimus","Erigeron aliceae",
  "Vancouveria hexandra","Mitella pentandra","Mimulus moschatus","Montia sibirica",
  "Sedum oregonense","Hypericum anagalloides","Mertensia paniculata","Platanthera sparsiflora",
  "Cerastium arvense","Erythronium grandiflorum","Hydrophyllum occidentale","Stachys chamissonis",
  "Lilium columbianum","Drymocallis glandulosa","Epilobium ciliatum","Lithophragma parviflorum",
  "Erysimum capitatum","Symphoricarpos albus","Saxifraga occidentalis","Hieracium cynoglossoides",
  "Holodiscus discolor","Claytonia lanceolata","Phacelia heterophila","Stachys rigida",
  "Xerophyllum tenax","Agoseris aurantiaca","Collinsia grandiflora","Solidago elongata",
  "Solidago lepida","Navarretia divaricata","Symphyotrichum foliaceum","Gayophytum diffusum",
  "Maianthemum stellatum","Barbarea orthoceras","Mimulus rubellus","Lewisia triphylla",
  "Viola glabella","Pedicularis bracteosa","Acmispon americanus","Lupinus latiflorus",
  "Valeriana sitchensis","Epilobium oregonense", "Achillea millefolium", "Prunella vulgaris"
)

#check length to make sure copilot gave back the right number of species excluding the non-natives, should be 118
length(native_plants)

##add NativePlant column to dataframe- if listed plant species in PlantGenusSpecies is in the native_plants vector, NativePlant will have TRUE, otherwise it will have FALSE
w_native_plants<- no_unknown %>%
  mutate(
    NativePlant = ifelse (PlantGenusSpecies %in% native_plants, yes=1, no=0)
  )

#check that values came out right
unique(w_native_plants$NativePlant)
```

add native pollinator column- 1 for native, 0 for non-native
```{r}
##used common non-native list from Lauren
non_native_bees<- c("Apis mellifera", "Megachile rotundata", "Anthidium manicatum", "Osmia cornifrons")

w_native_pollinators<- w_native_plants %>%
  mutate(
    NativePollinator = ifelse (PollinatorGenusSpecies %in% non_native_bees, yes=0, no=1)
  )

#check that values came out right
unique(w_native_pollinators$NativePollinator)
```
check final dataframe and export file to repository
```{r}
print(w_native_pollinators)

#reorder columns
re_ordered<- w_native_pollinators %>%
  select(Month, PollinatorGenusSpecies, NativePollinator, PlantGenusSpecies, NativePlant)

re_ordered

#export to folder in repository called clean_data (this folder needs to be created locally)
write.csv(re_ordered, "clean_data/HJ_data.csv", row.names = TRUE)
```

